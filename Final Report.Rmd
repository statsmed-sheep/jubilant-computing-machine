---
title: "Analysis of Sleep and Depression as Sex-Specific Risk Factors for Diabetes"
output:
  pdf_document: default
editor_options:
  chunk_output_type: console
---
```{r, include=FALSE, echo=FALSE, warning=FALSE, message=FALSE, error=FALSE}
# knitr settings to control how R chunks work and how the pdf is compiled when knit.
require(knitr)
require(xtable)
options(xtable.floating = FALSE)
options(xtable.timestamp = "")
require(tidyverse)
require(gtools)
require(broom)
opts_chunk$set(
  tidy=TRUE,                     # display code as typed
  size="small",                   # slightly smaller font for code
  tidy.opts=list(width.cutoff=65), # wrap text and long comments
  fig.width=4, fig.height=5           # figure size
)
```

## Abstract

  The purpose of our analysis is to investigate the interaction between sleep duration and depression frequency by sex as risk factors for diabetes, building on existing research that has established each of these risk factors independently. Using 2018 National Health Interview Survey data from the IPUMS database, we fit four logistic regression models with diabetic/non-diabetic status as the response variable. We found both sleep and daily or weekly depression to be significant predictors of diabetes in a simple model including both men and women and only the variables of interest. Sleep and daily or weekly depression were also significant in a full model including both sexes, all variables of interest and covariates. When analyzed separately by sex, daily or weekly depression frequency was found to be significant for both men and women. Sleep was found to be significant only for men. This research adds to the growing evidence of a link between mental and physical health.

\newpage

## Background and Significance

  With over 34 million Americans, or more than 1 in 10, diagnosed with the condition, diabetes is one of the most prevalent chronic diseases in the US $^1$. Diagnosed diabetics face an overall 60% greater risk of early death than non-diabetics, underlining the importance of identifying the most potent risk factors $^2$. In addition to other modifiable factors such as diet and physical activity, sleep and mental health have been explored as possible mediators of diabetes risk. 
    
  Several studies examining sleep and diabetes determined both short (<6 hrs) and long (>8 hrs) sleep duration to be as strongly associated with diabetes risk as traditional risk factors, such as family history of diabetes and overweightness $^3$$^4$. Furthermore, a meta-analysis reported that individuals with depression are 37% more likely to develop type 2 diabetes than their depression-free counterparts $^5$. Another review found that this increased risk varied between sexes $^6$.
    
  Despite having well-established relationships with diabetes independently, sleep and depression have not been thoroughly examined simultaneously as predictors of the condition. Because disturbed sleep could contribute to depression, and depression could also affect sleep patterns, a potential interaction effect between sleep and depression may be of interest when analyzing the relationship between sleep and diabetes risk. In this report we examine sleep and depression in tandem to diabetes risk.

## Methods 

### Data

  This study uses data from IPUMS-NHIS, the National Health Interview Survey from 2018. The data was collected by obtaining a random sample of 35,000 U.S. households and randomly selecting one adult and one child (if any were present) from each. Data analysis was restricted to those 18 years and older. An observational unit comprised of an individual adult in the U.S. surveyed by the CDC’s National Center for Health Statistics. The population to which we intend to generalize our analysis is the non institutionalized adult population of the United States (roughly 300 million individuals total).

### Variables

  The variables in our analysis include a binary response variable indicating whether or not an individual has diabetes, with average number of hours of sleep per night as the primary explanatory variable, a three-level categorical variable for the frequency an individual reports experiencing depression as the secondary explanatory variable, and sex as the tertiary explanatory variable. The three levels for depression frequency are “often” (defined as daily or weekly), “monthly”, and “rarely” (defined as a few times a year or never). In order to include this categorical variable in our model, we separated it into two binary variables for being depressed monthly or not and being depressed often or not, with being depressed rarely as the reference group. 
    
  Our covariates include age, BMI, activity level, income, and race. We created a numerical variable for activity score using the Oncology Nursing Society formula Weekly leisure activity score = (9 × Strenuous) + (5 × Moderate) + (3 × Light) from the Godin Leisure-Time Exercise Questionnaire. We substituted strength exercise for light exercise due to the availability of the IPUMS data, and we think strength training is analogous to light exercise for the purposes of our analysis. For simplicity and based on an analysis of faceted scatterplots, we collapsed the categorical race variable into 3 binary variables indicating black/African American or not, Asian or not, and Native American/Alaska Native or not, with white race as the reference group. For income level, we created two binary variables indicating high income (annual family income over \$75,000 or not) and middle income (annual family income between \$35,000 and \$75,000 or not), with low income (annual family income below \$35,000) as the reference group. Since our data is based on survey responses, all values are self-reported. Additionally, we did not include in our analysis any values that corresponded to non-response, inavailability, or extreme values that had been top or bottom coded.
    
### Analysis

  In order to analyze our primary, secondary, and tertiary hypothesis, we fit 4 different logistic regression models with the binary variable for diabetes or not as the response. Our first model includes only our primary and secondary explanatory variables in order to observe these relationships without accounting for the covariates. Our second model includes all of our explanatory variables and covariates, including the interaction terms between hours of sleep and depression frequency. Our third and fourth models represent males and females separately in order to observe differences by sex. Both include all covariates. We chose to perform a quadratic transformation on the sleep variable for all models in order account for the observation that both excessively short and long sleep are likely to increase diabetes risk, while a moderate amount of sleep (7-8 hours) is ideal. 
    
  In order to test the significance of each coefficient, we performed individual z-tests. In order to evaluate and compare the overall models, we performed likelihood ratio tests and calculated the percentage of concordant pairs for each model. 

## Results

  After filtering out non-applicable observations, we performed our analysis with a sample size of 21,229, with 46.4% males and a median age of 51 years. 1.9% (n = 407) of the individuals in the sample are classified as having chronic diabetes. The median number of hours of sleep per night is 7. The majority of individuals (83.78%) reported experiencing depression rarely, with 6.48% experiencing depression monthly, and 10.21% daily or weekly. The median BMI is 27.11, and the median activity score is 896. The income distribution is fairly even, with 38.54% classified as high income, 28.61% classified as middle income, and 32.87% classified as low income. The majority of individuals (81.09%) identified as white, with 5.51% identifying as Asian, 11.97% identifying as black, and 1.43% identifying as Native American or Alaska Native. 

  Based on individual z-tests, the coefficients for all explanatory variables were significant for the simple model (model 1) (p < 0.05). For the full model, the coefficients for sleep and daily or weekly depression frequency remained significant, while monthly depression frequency and the interactions between sleep and depression frequency were not significant (model 2). For models 3 and 4 (separated by sex), the coefficient for often depression frequency was found to be significant for both females and males, and the coefficients for sleep were significant only for males (p < 0.05). The likelihood ratio tests for all models yielded significant p-values (p < 0.05) indicating that all four models were significant overall. However, it is clear that the simple model (model 1) is much less accurate than the models including the covariates (models 2-4) as shown by the percentages of concordant pairs: 60.0%, 85.7%, 85.8%, and 86.3% respectively.
  
## Discussion

  Our analysis aimed to assess the relationship between sleep duration and depression in relation to diabetes risk. In figure 1.1, we see that if we do not account for the covariates, both short (< 7hrs) and long (> 8hrs) sleep are correlated with increased probability having diabetes (figure 1.1). This finding aligns with past studies documenting a U-shaped relationship between sleep duration and diabetes risk. Once we account for the covariates, however, there is no clear relationship between sleep and diabetes for either sex (figures 1.2, 2.1, and 2.2). When considering our secondary explanatory variable, depression frequency, without the covariates it is clear that experiencing depression often is associated with a much higher probability of having diabetes compared to experiencing depression monthly or rarely (figure 1.1). This observation supports our hypothesis as well as the pre-existing literature. However, the patterns appear random when accounting for the covariates.
  
  Daily/weekly depression was a significant predictor of depression in the overall population; when analyzed separately by sex, this variable was found to be significant for both men and women. This finding corroborates previous literature documenting sex differences in rates of depression among diabetics.

## Probability of Having Diabetes by Sleep and Depression Frequency

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
```

```{r, include=FALSE, echo = FALSE}
# read in data
data <- read.csv("data.csv")

library(tidyverse)
library(broom)
library(ggpubr)
```

```{r, include=FALSE, echo = FALSE}
## Model 1: SIMPLE MODEL

model_simple <- glm(chronic ~ HRSLEEP + I(HRSLEEP^2) + depfreq_often + depfreq_monthly, data = data, family = binomial)

summary(model_simple)

# significant coefficients: all

# Results for simple model:
# sleep significant at 0.001 level, p-value = 0.000447
# sleep squared significant at 0.001 level, p-value = 2.05e-06
# depfreq_often significant at 0.001 level, p-value < 2e-16
# depfreq_monthly significant at 0.05 level, p-value = 0.011191


## Model 2: FULL MODEL

# New with transformed sleep, excluding interaction with the original sleep variable
# AIC score: 3297.7

model_full <- glm(chronic ~ HRSLEEP + I(HRSLEEP^2) + depfreq_often + depfreq_monthly + I(I(HRSLEEP^2)*depfreq_often) + I(I(HRSLEEP^2)*depfreq_monthly) + log(AGE) + SEX + BMI + activity_score + income_high + income_middle + race_asian + race_black + race_na, family = binomial, data = data)

summary(model_full)

# significant coefficients: sleep, sleep squared, depfreq_often, all covariates

# Results for full model:
# sleep significant at 0.05 level, p-value = 0.0317
# sleep squared significant at 0.05 level, p-value = 0.0149
# depfreq_often significant at 0.001 level, p-value = 1.40e-05


## Model 3: FULL WOMEN

# Data 1: only women
data1 <- data %>% 
  filter(SEX == 1)

model_women <- glm(chronic ~ HRSLEEP + I(HRSLEEP^2) + depfreq_often + depfreq_monthly + I(I(HRSLEEP^2)*depfreq_often) + I(I(HRSLEEP^2)*depfreq_monthly) + log(AGE) + BMI + activity_score + income_high + income_middle + race_asian + race_black + race_na, family = binomial, data = data1)

summary(model_women)

# significant coefficients: depfreq_often, all covariates except race_na

# Results for women:
# depfreq_often significant at 0.01 level, p-value = 0.00145


## Model 4: FULL MEN

# Data 2: only men
data2 <- data %>% 
  filter(SEX == 0)

model_men <- glm(chronic ~ HRSLEEP + I(HRSLEEP^2) + depfreq_often + depfreq_monthly + I(I(HRSLEEP^2)*depfreq_often) + I(I(HRSLEEP^2)*depfreq_monthly) + log(AGE) + BMI + activity_score + income_high + income_middle + race_asian + race_black + race_na, family = binomial, data = data2)

summary(model_men)

# significant coefficients: sleep, sleep squared, depfreq_often, most covariates

# Result for men:
# sleep significant at 0.05 level, p-value = 0.02085
# sleep squared significant at 0.05 level, p-value = 0.01464
# depfreq_often significant at 0.01 level, p-value = 0.00292
```
  
```{r, echo = FALSE}
# code from Logistic Regression visualization practice activity 4/20/20
preds_full <- augment(x=model_full, type.predict = "response") %>%
  mutate(lci=`.fitted`-(1.96*`.se.fit`),
         uci=`.fitted`+(1.96*`.se.fit`)) %>%
  rename(prob=`.fitted`)

probs_full <- preds_full %>%
  select(prob,lci,uci, depfreq_often, depfreq_monthly, HRSLEEP, chronic)
```

```{r, warning = FALSE}
# code from Logistic Regression visualization practice activity 4/20/20
probs_full <- probs_full %>%
  filter(HRSLEEP %in% c(4, 5, 6, 7, 8, 9, 10)) %>%
  group_by(HRSLEEP, depfreq_often) %>%
  mutate(depfreq_often2 = ifelse(depfreq_often == 1, "Often", "Rarely")) %>%
  slice(1)

p1 <- ggplot(probs_full, aes(y = prob, x = HRSLEEP, color = as.factor(depfreq_often2))) +
      geom_pointrange(aes(ymin = lci, ymax = uci),
                      position = position_dodge(width = 3),
                      size = .75) +
         labs(title = "Figure 1.2",
           subtitle = "Model 2: Full Model",
           y = "Probability (Diabetes)", 
           x = "Sleep (hours/night)",
           color = "Depression Frequency") +
        theme_bw() +
  theme(text = element_text(size = 8))
```

```{r}
# code from Logistic Regression visualization practice activity 4/20/20
preds_women <- augment(x=model_women, type.predict = "response") %>%
  mutate(lci=`.fitted`-(1.96*`.se.fit`),
         uci=`.fitted`+(1.96*`.se.fit`)) %>%
  rename(prob=`.fitted`)

probs_women <- preds_women %>%
  select(prob,lci,uci, depfreq_often, depfreq_monthly, HRSLEEP, chronic)
```

```{r, warning = FALSE}
# code from Logistic Regression visualization practice activity 4/20/20
probs_women <- probs_women %>%
  filter(HRSLEEP %in% c(4, 5, 6, 7, 8, 9, 10)) %>%
  group_by(HRSLEEP, depfreq_often) %>%
  mutate(depfreq_often2 = ifelse(depfreq_often == 1, "Often", "Rarely")) %>%
  slice(1)

p2 <- ggplot(probs_women, aes(y = prob, x = HRSLEEP, color = as.factor(depfreq_often2))) +
      geom_pointrange(aes(ymin = lci, ymax = uci),
                      position = position_dodge(width = 3),
                      size = .75) +
        labs(title = "Figure 2.1",
           subtitle = "Model 3: Full Model, Women",
           y = "Probability (Diabetes)", 
           x = "Sleep (hours/night)",
           color = "Depression Frequency") +
        theme_bw() +
  theme(text = element_text(size = 8))
```

```{r}
# code from Logistic Regression visualization practice activity 4/20/20
preds_men <- augment(x=model_men, type.predict = "response") %>%
  mutate(lci=`.fitted`-(1.96*`.se.fit`),
         uci=`.fitted`+(1.96*`.se.fit`)) %>%
  rename(prob=`.fitted`)

probs_men <- preds_men %>%
  select(prob,lci,uci, depfreq_often, depfreq_monthly, HRSLEEP, chronic)
```

```{r, warning = FALSE}
# code from Logistic Regression visualization practice activity 4/20/20
probs_men <- probs_men %>%
  filter(HRSLEEP %in% c(4, 5, 6, 7, 8, 9, 10)) %>%
  group_by(HRSLEEP, depfreq_often) %>%
  mutate(depfreq_often2 = ifelse(depfreq_often == 1, "Often", "Rarely")) %>%
  slice(1)

p3 <- ggplot(probs_men, aes(y = prob, x = HRSLEEP, color = as.factor(depfreq_often2))) +
      geom_pointrange(aes(ymin = lci, ymax = uci),
                      position = position_dodge(width = 3),
                      size = .75) +
        labs(title = "Figure 2.2",
           subtitle = "Model 4: Full Model, Men",
           y = "Probability (Diabetes)",
           x = "Sleep (hours/night)",
           color = "Depression Frequency") +
        theme_bw() +
  theme(text = element_text(size = 8))
  
```

```{r}
# code from Logistic Regression visualization practice activity 4/20/20
preds_simple <- augment(x=model_simple, type.predict = "response") %>%
  mutate(lci=`.fitted`-(1.96*`.se.fit`),
         uci=`.fitted`+(1.96*`.se.fit`)) %>%
  rename(prob=`.fitted`)

probs_simple <- preds_simple %>%
  select(prob, lci, uci, depfreq_often, depfreq_monthly, HRSLEEP, chronic)
```

```{r, warning = FALSE, message = FALSE}
# code from Logistic Regression visualization practice activity 4/20/20
probs_simple <- probs_simple %>%
  filter(HRSLEEP %in% c(4, 5, 6, 7, 8, 9, 10)) %>%
  group_by(HRSLEEP, depfreq_often) %>%
  mutate(depfreq_often2 = ifelse(depfreq_often == 1, "Often", "Rarely")) %>% 
  slice(1)

p4 <- ggplot(probs_simple, aes(y = prob, x = HRSLEEP, color = as.factor(depfreq_often2))) +
      geom_pointrange(aes(ymin = lci, ymax = uci),
                      position = position_dodge(width = 3),
                      size = .75) +
         labs(
           title = "Figure 1.1",
           subtitle = "Model 1: Simple Model",
           y = "Probability (Diabetes)", 
           x = "Sleep (hours/night)",
           color = "Depression Frequency") +
        theme_bw() + 
  theme(text = element_text(size = 8))
```

```{r}
 # Figure 1. Simple and full model
 plots_combined <- ggarrange(p4, p1, p2, p3,
           ncol = 2, nrow = 2,
           common.legend = TRUE, legend = "bottom",
           widths = 200, heights = 200)
plots_combined
```

### Limitations

  The limitations of our analysis include the inability to account for additional covariates including diet, genetics, sleep quality and other health conditions, as well as the fact that all values are self-reported, which could result in less accurate data. Future analyses should take into account the fact that abundant literature has identified both short and long sleep as significant risk factors for diabetes. Our analysis was focused on short sleep, but it could be beneficial to divide the numerical sleep variable into categories in order to compare the individual relationships of short, average, and long sleep with diabetes risk. Furthermore, we cannot draw any causal inferences due to the nature of the data. Future studies in a controlled setting ought to examine the direction of the relationship between diabetes, sleep, and depression.

### Conclusion

  Although our findings in relation to sleep were somewhat inconclusive, it is clear from our analysis that experiencing depression daily or weekly is significantly associated with developing chronic diabetes, particularly for women. This research adds to the growing evidence of a link between mental and physical health.

\newpage

## References

1. “Diabetes | Social Media | Resource Center | Diabetes | CDC,” February 13, 2020. https://www.cdc.gov/diabetes/library/socialmedia/infographics/diabetes.html.

2. Anothaisintawee, Thunyarat, Sirimon Reutrakul, Eve Van Cauter, and Ammarin Thakkinstian. “Sleep Disturbances Compared to Traditional Risk Factors for Diabetes Development: Systematic Review and Meta-Analysis.” Sleep Medicine Reviews 30 (2016): 11–24. https://doi.org/10.1016/j.smrv.2015.10.002.

3. Cappuccio, Francesco P., Lanfranco D’Elia, Pasquale Strazzullo, and Michelle A. Miller. “Quantity and Quality of Sleep and Incidence of Type 2 Diabetes: A Systematic Review and Meta-Analysis.” Diabetes Care 33, no. 2 (February 2010): 414–20. https://doi.org/10.2337/dc09-1124.

4. Cappuccio, Francesco P., and Michelle A. Miller. “Sleep and Cardio-Metabolic Disease.” Current Cardiology Reports 19, no. 11 (2017). https://doi.org/10.1007/s11886-017-0916-0.

5. Holt, Richard I. G., Mary de Groot, and Sherita Hill Golden. “Diabetes and Depression.” Current Diabetes Reports 14, no. 6 (June 2014): 491. https://doi.org/10.1007/s11892-014-0491-3.

6. Ogilvie, Rachel P., and Sanjay R. Patel. “The Epidemiology of Sleep and Diabetes.” Current Diabetes Reports 18, no. 10 (August 17, 2018): 82. https://doi.org/10.1007/s11892-018-1055-8.
