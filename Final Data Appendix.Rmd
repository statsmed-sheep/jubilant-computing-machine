---
title: "Final Data Appendix"
author: "Rose Porta and Clara Li"
date: "6/6/2020"
output: pdf_document
---

```{r, include = FALSE, warning = FALSE, message = FALSE, options(tinytex.verbose = TRUE)}
library(tidyverse)
library(stats)
library(knitr)
library(xtable)
data <- read.csv("data.csv")
# Defining logit function (got an error before)
logit <- qlogis
```

# Checking Regression Assumptions

## Linearity

The empirical logit plot seems approximately linear.

```{r, echo = FALSE, warning = FALSE, message = FALSE}
# Code from 18-simplelogistic-lab activity to generate x and y values for plot to check for linearity
data_bin <- data %>%
  # Break HRSLEEP into 10 bins
  mutate(HRSLEEP_group = cut(HRSLEEP, breaks=10)) %>% 
  group_by(HRSLEEP_group) %>%
  # calculate mean HRSLEEP value and proportion obese in each bin
  mutate(binned.y = mean(chronic), binned.x = mean(HRSLEEP)) %>% 
  # transform binned.y from proportion to log(odds)
  mutate(binned.y_logit = logit(binned.y))

# Create plot of log(odds) verus age
ggplot(data_bin, aes(x = binned.x, y = binned.y_logit)) +
  geom_point() + 
  geom_smooth(method = lm, se = FALSE)
```

## Randomness

Obviously, individuals are not assigned BMIs by a spinner model, but since we have a random sample, the randomness assumption is met.

## Independence

As established above for the linear regression model, the independence assumption is reasonable for this data set.

# Checking Collinearity between Explanatory Variables

```{r, echo = FALSE, warning = FALSE, messsage = FALSE}
data <- data %>% 
  select(chronic, depfreq_often, depfreq_monthly, HRSLEEP, AGE, BMI, activity_score, SEX,
         race_asian, race_black, race_na, income_high, income_middle)
data.cor = cor(data)
round_data <- function(x, digits) {
    # round all numeric variables
    # x: data frame 
    # digits: number of digits to round
    numeric_columns <- sapply(x, mode) == 'numeric'
    x[numeric_columns] <-  round(x[numeric_columns], digits)
    x
}
round_data(data.cor, 3)
```

The largest magnitude correlation in the correlation matrix above is 0.50. Collinearity therefore appears to not be a concern.

# Summary Statistics

# Full Logistic Model Coefficient Summary

```{r, echo = FALSE, results = 'asis'}
coeff <- c("HRSLEEP", "depfreq_often**", "depfreq_monthly", "I(HRSLEEP * depfreq_often)", "I(HRSLEEP * depfreq_monthly)")
value <- c(1.350e-02, 1.315e+00, 3.321e-01, -5.686e-02, 4.482e-02)
LCI <- c(9.400140e-01, 1.538202e+00, 3.350283e-01, 8.367457e-01, 8.600010e-01)
UCI <- c(1.089396e+00, 8.944554e+00, 5.819625e+00, 1.065370e+00, 1.257594e+00)
p_val <- c(0.72002, 0.00341, 0.64860, 0.35585, 0.64349)

df <- data.frame(coeff, value, LCI, UCI, p_val)
df <- xtable(df)
print.xtable(df)
```

* = significant at the 0.01 level

# Likelihood Ratio Test Results

```{r, echo = FALSE, results = 'asis'}
model <- c("Full", "Control")
degf <- c("15", "1")
log_likelihood <- c("-1635.1", "-2012.5")
chisq <- c("--", "754.74")
p_val <- c("--", "<2.2e-16")

lrdata <- data.frame(model, degf, log_likelihood, chisq, p_val)
lrdata <- xtable(lrdata)
print.xtable(lrdata)
```

